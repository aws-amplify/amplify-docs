---
title: Custom CloudFormation stacks
description: The Amplify CLI provides escape hatches for modifying the backend configurations generated in the form of Cloudformation templates by the CLI. This allows you to use the CLI for common flows but also any advanced scenarios which aren't provided in the standard category workflows.
---

The Amplify CLI provides escape hatches for modifying the backend configurations generated in the form of Cloudformation templates by the CLI. This allows you to use the CLI for common flows but also any advanced scenarios which aren't provided in the standard category workflows.

* For your GraphQL API generated by the Amplify CLI, you have the ability to [override resolvers](~/cli/graphql-transformer/resolvers.md#overwriting-resolvers) as well as add your own [custom resolvers](~/cli/graphql-transformer/resolvers.md#custom-resolvers) to add on to the CLI generated Cloudformation stacks.

* For majority of the other categories, you can locally edit and manage the Cloudformation file generated by the CLI in the `amplify/backend/<category>/<cloudformation-template.json/yml>` location. [Read more about Cloudformation](https://aws.amazon.com/cloudformation/)

* For adding and deploying a Cloudformation stack for an AWS Service not supported by the Amplify CLI currently, go through the following steps:

1. Modify `amplify/backend/backend-config.json` in your project:
```
{
  "<custom-category-name>": {
    "<custom-resource-name>": {
      "service": <custom-aws-service-name>,
      "providerPlugin": "awscloudformation"
    }
  },
  "hosting": {
    "S3AndCloudFront": {
      "service": "S3AndCloudFront",
      "providerPlugin": "awscloudformation"
    }
  }
}
```

Note: You can also reference an output value from any other Amplify managed category cloudformation stack. For example, if you want to use the Amazon Cognito `userpool ID` generated by the `auth` category stack in your custom cloudformation stack, you would need to add the `dependsOn` block in the `backend-config.json` file, The above `backend-config.json` file would look like the following:

```javascript
{
  "<custom-category-name>": {
    "<custom-resource-name>": {
      "service": <custom-aws-service-name>,
      "providerPlugin": "awscloudformation",
      "dependsOn": [
	{
         "category": "auth",
	 "resourceName": "mycognitoresource", // check `amplify status` to find resource name
	 "attributes": [
	    "UserPoolId" // Check Output Value of the resource specific cloudformation file to find available attributes
	  ]
	}
     ]
    }
  },
  "hosting": {
    "S3AndCloudFront": {
      "service": "S3AndCloudFront",
      "providerPlugin": "awscloudformation"
    }
  }
}
```

2. Under `amplify/backend` folder, make a folder structure like the following:
  ```
  amplify
    \backend
      \<custom-category-name>
        \<custom-resource-name>
          parameters.json
          template.json
      \hosting
        parameters.json
        template.json
  ```
  `template.json` is a cloudformation template, and `parameters.json` is a json file of parameters that will be passed to the cloudformation template. Additionally, the `env` parameter will be passed in to your cloudformation templates dynamically by the CLI. Note: If you have multiple resources in the same category, the cloudformation template files names must be unique.

3. To use the above mentioned attribute `UserPoolId` from the auth category in your custom cloudformation stack, you would need to construct the following input parameter in the `template.json` file. The CLI will be passing this input automatically from the other nested stack.

```javascript
"Parameters": {
  // Rest of the parameters
 
  "authmycognitoresourceUserPoolId": { // The format out here is `<category><resource-name><attribute-name>` - we have defined all of these in the `backend-config.json` file above
	 "Type": "String"
 }
},
```

4. Place one parameter in `parameters.json` named `authmycognitoresourceUserPoolId` with a cloudformation `Fn::GetAtt` that connects the output of one nested template to your custom template.

  ```
  	{
    	   "authmycognitoresourceUserPoolId": {  // The format out here is `<category><resource-name><attribute-name>` - we have defined all of these in the `backend-config.json` file above
              "Fn::GetAtt": [
            	 "authmycognitoresource",  // check `amplify status` to find resource name in the category auth
            	 "Outputs.UserPoolId"
              ]
    	   }
	}
  ```

5. Run `amplify env checkout <current-env-name>` to populate the CLI runtime files and make it aware of the newly added custom resources
